{
  "version": 3,
  "sources": ["../src/open-spaces.tsx", "../src/components/OpenInCapacities.tsx", "../src/helpers/storage.ts"],
  "sourcesContent": ["import { List, ActionPanel, Action, Icon } from \"@raycast/api\";\nimport OpenInCapacities from \"./components/OpenInCapacities\";\nimport { useEffect } from \"react\";\nimport { useCapacitiesStore } from \"./helpers/storage\";\n\nexport default function Command() {\n  const { isLoading, store, triggerLoading } = useCapacitiesStore();\n\n  useEffect(() => {\n    triggerLoading();\n  }, []);\n\n  return (\n    <List isLoading={isLoading}>\n      {store?.spaces.map((space) => (\n        <List.Item\n          key={space.id}\n          title={space.title}\n          icon={Icon.Desktop}\n          actions={\n            <ActionPanel>\n              <OpenInCapacities target={space.id} />\n              <Action.CopyToClipboard content={space.id} title=\"Copy Space ID\" />\n            </ActionPanel>\n          }\n        />\n      ))}\n    </List>\n  );\n}\n", "import { Action, popToRoot } from \"@raycast/api\";\n\ntype OpenInCapacitiesProps = {\n  target: string;\n  title?: string;\n};\n\nexport default function OpenInCapacities({ title, target }: OpenInCapacitiesProps) {\n  return (\n    <>\n      <Action.Open\n        title={`${title ? title : \"Open\"} in Capacities`}\n        icon=\"capacities.png\"\n        target={`capacities://${target}`}\n        application=\"Capacities\"\n        onOpen={() => {\n          popToRoot();\n        }}\n      />\n      <Action.OpenInBrowser\n        url={`https://app.capacities.io/${target}`}\n        title={`${title ? title : \"Open\"} in Browser`}\n        onOpen={() => {\n          popToRoot();\n        }}\n      />\n    </>\n  );\n}\n", "import { LocalStorage, Toast, getPreferenceValues, open, openExtensionPreferences, showToast } from \"@raycast/api\";\nimport { useState } from \"react\";\n\nconst { communicationToken } = getPreferenceValues<Preferences>();\nexport const API_URL = \"http://localhost:10334\";\nexport const API_HEADERS = {\n  Accept: \"application/json\",\n  Authorization: `Bearer ${communicationToken}`,\n  \"Content-Type\": \"application/json\",\n};\nconst SPACES_UPDATE_INTERVAL = 0;\nconst SPACE_INFO_UPDATE_INTERVAL = 0;\n\n// API TYPES\ntype GetSpacesInfoResponse = {\n  spaces: {\n    id: string;\n    title: string;\n    icon: unknown;\n  }[];\n};\n\ntype GetSpaceInfoResponse = {\n  structures: {\n    id: string;\n    title: string;\n    pluralName: string;\n    propertyDefinitions: {\n      type: string;\n      id: string;\n      dataType: string;\n      name: string;\n    }[];\n    labelColor: string;\n    collections: {\n      id: string;\n      title: string;\n    }[];\n  }[];\n};\n\ntype CapacitiesStore = {\n  spacesLastUpdated: string | undefined;\n  spaces: { id: string; title: string }[];\n  spacesInfo: {\n    [key: string]:\n      | {\n          lastUpdated: string;\n          structures: GetSpaceInfoResponse[\"structures\"];\n        }\n      | undefined;\n  };\n};\n\nexport function handleAPIError(response: Response) {\n  if (response.ok) return;\n  const status = response.status;\n  if (status === 401) {\n    showToast({\n      style: Toast.Style.Failure,\n      title: \"You're communication token is invalid\",\n      message: \"Please update your communication token in the extension preferences and try again.\",\n      primaryAction: {\n        title: \"Open Extension Preferences\",\n        onAction: () => openExtensionPreferences(),\n        shortcut: {\n          modifiers: [\"cmd\"],\n          key: \"o\",\n        },\n      },\n    });\n  } else {\n    showToast({\n      style: Toast.Style.Failure,\n      title: \"Something went wrong\",\n      message: `Error Message: ${response.status} - ${response.statusText}`,\n    });\n  }\n}\n\nexport function handleUnexpectedError(error: Error) {\n  if (error.message.includes(\"fetch failed\")) {\n    showToast({\n      style: Toast.Style.Failure,\n      title: \"Cannot connect\",\n      message:\n        \"Capacities needs to be open for the extension to work. Please open Capacities and try again. If the problem persists, please check if you activated the extension in the Capacities settings.\",\n      primaryAction: {\n        title: \"Open Capacities\",\n        onAction: () => open(\"capacities://\", \"Capacities\"),\n        shortcut: {\n          modifiers: [\"cmd\"],\n          key: \"o\",\n        },\n      },\n    });\n  } else {\n    showToast({\n      style: Toast.Style.Failure,\n      title: \"An unexpected error occurred\",\n      message: `Capacities needs to be open for the extension to work. Please open Capacities and try again. If the problem persists, please check if you activated the extension in the Capacities settings. (Error Message: ${error.message})`,\n      primaryAction: {\n        title: \"Open Capacities\",\n        onAction: () => open(\"capacities://\", \"Capacities\"),\n        shortcut: {\n          modifiers: [\"cmd\"],\n          key: \"o\",\n        },\n      },\n    });\n  }\n}\n\nasync function getCapacitiesStore(): Promise<CapacitiesStore> {\n  const store = await LocalStorage.getItem<string>(\"capacitiesStore\");\n  if (store) {\n    return JSON.parse(store);\n  } else {\n    return {\n      spacesLastUpdated: undefined,\n      spaces: [],\n      spacesInfo: {},\n    };\n  }\n}\n\nexport async function loadAndSaveCapacitiesStore(forceUpdate: boolean): Promise<CapacitiesStore | undefined> {\n  let store: CapacitiesStore | undefined = undefined;\n  try {\n    store = await getCapacitiesStore();\n    if (\n      forceUpdate ||\n      !store.spacesLastUpdated ||\n      Date.now() - new Date(store.spacesLastUpdated).getTime() > SPACES_UPDATE_INTERVAL\n    ) {\n      const response = await fetch(`${API_URL}/spaces`, {\n        headers: API_HEADERS,\n      });\n\n      if (!response.ok) {\n        handleAPIError(response);\n        return store;\n      }\n      const result = (await response.json()) as GetSpacesInfoResponse;\n      const data = result;\n\n      if (data.spaces) {\n        store.spaces = data.spaces.map((el) => {\n          return {\n            id: el.id,\n            title: el.title,\n          };\n        });\n      }\n      const spaces = data?.spaces || [];\n      for (const space of spaces) {\n        const index = store.spaces.findIndex((s) => s.id === space.id);\n        if (index === -1) {\n          store.spaces.push({\n            id: space.id,\n            title: space.title,\n          });\n        } else {\n          store.spaces[index] = {\n            id: space.id,\n            title: space.title,\n          };\n        }\n      }\n      store.spacesLastUpdated = new Date().toISOString();\n    }\n\n    const spaceIdsToUpdate: string[] = [];\n    for (const [spaceId, spaceInfo] of Object.entries(store.spacesInfo)) {\n      if (!store.spaces.find((s) => s.id === spaceId)) {\n        delete store.spacesInfo[spaceId];\n      } else {\n        if (\n          forceUpdate ||\n          !spaceInfo?.lastUpdated ||\n          Date.now() - new Date(spaceInfo?.lastUpdated).getTime() > SPACE_INFO_UPDATE_INTERVAL\n        ) {\n          spaceIdsToUpdate.push(spaceId);\n        }\n      }\n    }\n\n    for (const space of store.spaces) {\n      if (!store.spacesInfo[space.id]) {\n        spaceIdsToUpdate.push(space.id);\n      }\n    }\n\n    for (const spaceId of spaceIdsToUpdate) {\n      const response = await fetch(`${API_URL}/space-info?spaceid=${spaceId}`, {\n        headers: API_HEADERS,\n      });\n      if (!response.ok) {\n        handleAPIError(response);\n        return store;\n      }\n      const result = (await response.json()) as GetSpaceInfoResponse;\n      const data = result;\n      store.spacesInfo[spaceId] = {\n        lastUpdated: new Date().toISOString(),\n        structures: data.structures,\n      };\n    }\n\n    await LocalStorage.setItem(\"capacitiesStore\", JSON.stringify(store));\n    return store;\n  } catch (e) {\n    if (e instanceof Error) {\n      handleUnexpectedError(e);\n    } else {\n      console.log(e);\n    }\n    return undefined;\n  }\n}\n\nexport function useCapacitiesStore(forceUpdate = false) {\n  const [isLoading, setIsLoading] = useState(true);\n  const [store, setStore] = useState<CapacitiesStore | undefined>(undefined);\n\n  function triggerLoading() {\n    getCapacitiesStore()\n      .then((store) => {\n        setStore(store);\n        if (store.spacesLastUpdated) {\n          setIsLoading(false);\n        }\n      })\n      .catch((e) => {\n        if (e instanceof Error) {\n          handleUnexpectedError(e);\n        } else {\n          console.log(e);\n        }\n      });\n\n    loadAndSaveCapacitiesStore(forceUpdate).then((store) => {\n      if (!store) return;\n      setStore(store);\n      if (store.spacesLastUpdated) {\n        setIsLoading(false);\n      } else {\n        handleUnexpectedError(new Error(\"Failed to load Capacities store\"));\n      }\n    });\n  }\n\n  return { store, isLoading, triggerLoading };\n}\n"],
  "mappings": "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",
  "names": ["open_spaces_exports", "__export", "Command", "__toCommonJS", "import_api", "import_api", "import_jsx_runtime", "OpenInCapacities", "title", "target", "import_react", "import_api", "import_react", "communicationToken", "API_URL", "API_HEADERS", "SPACES_UPDATE_INTERVAL", "SPACE_INFO_UPDATE_INTERVAL", "handleAPIError", "response", "handleUnexpectedError", "error", "getCapacitiesStore", "store", "loadAndSaveCapacitiesStore", "forceUpdate", "data", "el", "spaces", "space", "index", "s", "spaceIdsToUpdate", "spaceId", "spaceInfo", "e", "useCapacitiesStore", "isLoading", "setIsLoading", "setStore", "triggerLoading", "import_jsx_runtime", "Command", "isLoading", "store", "triggerLoading", "useCapacitiesStore", "space", "OpenInCapacities"]
}
